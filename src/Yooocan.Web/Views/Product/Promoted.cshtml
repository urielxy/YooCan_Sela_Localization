@using System.Security.Claims
@model List<Yooocan.Models.Products.PromotedProductModel>
<div class="container" style="margin-top: 20px;">
    @*@PromotionType.New.Humanize() = @((int)PromotionType.New)<br />
        @PromotionType.Popular.Humanize() = @((int)PromotionType.Popular)<br />*@
    <table class="bordered striped" id="promotion-table" style="margin: 20px 0;">
        <thead>
            <tr>
                <th>Product ID</th>
                <th>Title</th>
                <th>Promotion type</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var product in Model)
            {
                <tr>
                    <td data-field="ProductId">@product.ProductId</td>
                    <td>@product.Name</td>
                    @*<td data-field="PromotionType">@((int)product.PromotionType)</td>*@
                    <td><button class="btn-flat delete">DELETE</button></td>
                </tr>
            }
        </tbody>
    </table>
    <div>
        <a class="left new btn" id="add-new-product">ADD NEW PRODUCTS</a>
        <button type="button" class="right btn" id="submit-promotions">SAVE CHANGES</button>
    </div>
</div>
@section scripts{
    <script>
        $('#promotion-table').on('click', '.delete', function () {
            $(this).closest('tr').remove();
        });
        $("#add-new-product").click(function () {
            var $tr = $('<tr>')
                .append('<td data-field="ProductId"><input placeholder="Product ID"/></td>')
                .append('<td>')
                //.append($('<td data-field="PromotionType"><input placeholder="PromotionType"/></td>'))
                .append('<td><button class="btn-flat delete">DELETE</button></td>');
            $('#promotion-table tbody').append($tr);
        });

        $('#submit-promotions').click(function() {
            var data = $('#promotion-table tbody tr').map(function() {
                var o = {};
                $(this).find('td[data-field]').each(function() {
                    o[$(this).data('field')] = $(this).find('input').val() || this.innerHTML.trim();
                });
                return o;
            }).get();

            $.ajax({
                    url: '@Url.Action("Promoted")',
                    type: 'POST',
                    data: JSON.stringify(data),
                    contentType: 'application/json'
                })
                .done(function() {
                    window.location.reload();
                })
                .fail(function() {
                    Materialize
                        .toast('Sorry @User.FindFirstValue(ClaimTypes.GivenName) :( Something went wrong!, call Evgeny', 10000);
                });
            return false;
        });
    </script>
}